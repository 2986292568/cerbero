# -*- Mode: Python -*- vi:si:et:sw=4:sts=4:ts=4:syntax=python

class Recipe(recipe.Recipe):
    name = 'glib'
    version = '2.30.3'
    license = 'LGPLv2'
    configure_sh = 'sh autogen.sh'
    deps = ['libffi', 'zlib']
    platform_deps = {Platform.WINDOWS: ['libiconv', 'gettext'],
                     Platform.DARWIN: ['libiconv', 'gettext']}

    files_libs = [
        'libglib-2.0', 'libgio-2.0', 'libgmodule-2.0', 'libgobject-2.0',
        'libgthread-2.0']
    files_bins = [
        'glib-gettextize', 'glib-mkenums', 'glib-compile-schemas',
        'glib-genmarshal']
    files_dev = [
        'lib/gio'
        'lib/glib-2.0/include/glibconfig.h',
        'lib/pkgconfig/gio-2.0.pc',
        'lib/pkgconfig/glib-2.0.pc',
        'lib/pkgconfig/gmodule-2.0.pc',
        'lib/pkgconfig/gobject-2.0.pc',
        'lib/pkgconfig/gthread-2.0.pc',
        'include/glib-2.0']
    files_dev_platform = {
        Platform.WINDOWS: ['lib/pkgconfig/gio-windows-2.0.pc', 'include/gio-win32-2.0'],
    }


    def prepare(self):
        if self.config.target_platform == Platform.WINDOWS:
            self.configure_options = '--with-libiconv=gnu'
        elif self.config.target_platform == Platform.DARWIN:
            self.config_sh = 'CFLAGS="$CFLAGS -DHAVE_STRNDUP" ./configure'
        elif self.config.target_platform == Platform.LINUX:
            if self.config.target_distro == Distro.DEBIAN and self.config.target_distro_version in [DistroVersion.DEBIAN_SQUEEZE, DistroVersion.UBUNTU_LUCID, DistroVersion.UBUNTU_MAVERICK]:
                self.config_sh = 'CFLAGS="$CFLAGS -DGST_SDK_GLIB_GIO_OLD_URI_SCHEME_HANDLERS=1 -DGST_SDK_GLIB_GIO_DISTRO_GIO_MODULE_PATH=\\\\\\\"/usr/lib/gio/modules\\\\\\\"" ./configure'
            elif self.config.target_distro == Distro.DEBIAN and self.config.target_distro_version in [DistroVersion.UBUNTU_NATTY, DistroVersion.UBUNTU_ONEIRIC]:
                if self.config.target_arch == Architecture.X86:
                    self.config_sh = 'CFLAGS="$CFLAGS -DGST_SDK_GLIB_GIO_DISTRO_GIO_MODULE_PATH=\\\\\\\"/usr/lib/gio/modules\\\\\\\" -DGST_SDK_GLIB_GIO_DISTRO_GIO_MODULE_PATH2=\\\\\\\"/usr/lib/i386-linux-gnu/gio/modules\\\\\\\"" ./configure'
                elif self.config.target_arch == Architecture.X86_64:
                    self.config_sh = 'CFLAGS="$CFLAGS -DGST_SDK_GLIB_GIO_DISTRO_GIO_MODULE_PATH=\\\\\\\"/usr/lib/gio/modules\\\\\\\" -DGST_SDK_GLIB_GIO_DISTRO_GIO_MODULE_PATH2=\\\\\\\"/usr/lib/x86_64-linux-gnu/gio/modules\\\\\\\"" ./configure'
            elif self.config.target_distro == Distro.DEBIAN and self.config.target_distro_version in [DistroVersion.DEBIAN_WHEEZY]:
                if self.config.target_arch == Architecture.X86:
                    self.config_sh = 'CFLAGS="$CFLAGS -DGST_SDK_GLIB_GIO_DISTRO_GIO_MODULE_PATH=\\\\\\\"/usr/lib/i386-linux-gnu/gio/modules\\\\\\\"" ./configure'
                elif self.config.target_arch == Architecture.X86_64:
                    self.config_sh = '''CFLAGS="$CFLAGS -DGST_SDK_GLIB_GIO_DISTRO_GIO_MODULE_PATH=\\\\\\\"/usr/lib/x86_64-linux-gnu/gio/modules\\\\\\\"" ./configure'''
            else:
                raise FatalError(_("Add specific for other Linux distributions here"))
