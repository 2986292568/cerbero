# vi:si:et:sw=4:sts=4:ts=4:syntax=python
# -*- Mode: Python -*-

from cerbero import recipe

class Recipe(recipe.Recipe):
    name = 'glib'
    version = '2.30.2'
    configure_sh = 'sh autogen.sh'
    deps = ['libffi', 'zlib']
    platform_deps = {Platform.WINDOWS: ['libiconv', 'gettext'],
                     Platform.DARWIN: ['libiconv', 'gettext']}

    def prepare(self):
        if self.config.target_platform == Platform.WINDOWS:
            self.configure_options = '--with-libiconv=gnu'
        elif self.config.target_platform == Platform.DARWIN:
            self.config_sh = 'CFLAGS="$CFLAGS -DHAVE_STRNDUP" ./configure'
        elif self.config.target_platform == Platform.LINUX:
            if self.config.target_distro == Distro.DEBIAN and self.config.target_distro_version in [DistroVersion.DEBIAN_SQUEEZE, DistroVersion.UBUNTU_LUCID]:
                self.config_sh = 'CFLAGS="$CFLAGS -DGST_SDK_GLIB_GIO_OLD_URI_SCHEME_HANDLERS=1 -DGST_SDK_GLIB_GIO_DISTRO_GIO_MODULE_PATH=\\\\\\\"/usr/lib/gio/modules\\\\\\\"" ./configure'
            elif self.config.target_distro == Distro.DEBIAN and self.config.target_distro_version in [DistroVersion.UBUNTU_NATTY, DistroVersion.UBUNTU_ONEIRIC]:
                self.config_sh = 'CFLAGS="$CFLAGS -DGST_SDK_GLIB_GIO_DISTRO_GIO_MODULE_PATH=\\\\\\\"/usr/lib/gio/modules\\\\\\\"" ./configure'
            elif self.config.target_distro == Distro.DEBIAN and self.config.target_distro_version in [DistroVersion.DEBIAN_WHEEZY]:
                if self.config.target_arch == Architecture.X86:
                    self.config_sh = 'CFLAGS="$CFLAGS -DGST_SDK_GLIB_GIO_DISTRO_GIO_MODULE_PATH=\\\\\\\"/usr/lib/i386-linux-gnu/gio/modules\\\\\\\"" ./configure'
                elif self.config.target_arch == Architecture.X86_64:
                    self.config_sh = '''CFLAGS="$CFLAGS -DGST_SDK_GLIB_GIO_DISTRO_GIO_MODULE_PATH=\\\\\\\"/usr/lib/x86_64-linux-gnu/gio/modules\\\\\\\"" ./configure'''
            else:
                raise FatalError(_("Add specific for other Linux distributions here"))
